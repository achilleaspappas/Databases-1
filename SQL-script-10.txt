DROP DATABASE IF EXISTS PERSONNEL;
CREATE DATABASE PERSONNEL;
USE PERSONNEL;

CREATE TABLE DEPT (DEPTNO INT(2) NOT NULL, DNAME VARCHAR(15), PRIMARY KEY (DEPTNO) );

DESCRIBE DEPT;

# Field	Type		Null	Key	Default	Extra
DEPTNO	int		NO	PRI		
DNAME	varchar(15)	YES			


CREATE TABLE JOB (JOBNO INT(3) NOT NULL, JOB VARCHAR(15), SAL FLOAT(7,2), PRIMARY KEY (JOBNO) );

DESCRIBE JOB;

# Field	Type		Null	Key	Default	Extra
JOBNO	int		NO	PRI		
JOB	varchar(15)	YES			
SAL	float(7,2)	YES			


CREATE TABLE EMP (EMPNO INT(4) NOT NULL, ENAME VARCHAR(10), JOBCODE INT(3), DEPTNO INT(2), 
PRIMARY KEY (EMPNO), FOREIGN KEY (JOBCODE) REFERENCES JOB(JOBNO),
FOREIGN KEY (DEPTNO) REFERENCES DEPT(DEPTNO)); 

DESCRIBE EMP;

# Field	Type		Null	Key	Default	Extra
EMPNO	int		NO	PRI		
ENAME	varchar(10)	YES			
JOBCODE	int		YES	MUL		
DEPTNO	int		YES	MUL	


INSERT INTO DEPT VALUES (10, "ACCOUNTING"), (20, "SALES"), (30, "PERSONNEL");	

SELECT * FROM DEPT;

# DEPTNO  DNAME
10	  ACCOUNTING
20	  SALES
30	  PERSONNEL


INSERT INTO JOB VALUES (100, "DBA", 2500), (200, "ANALYST", 2000);

SELECT * FROM JOB;

# JOBNO	JOB	SAL
100	DBA	2500.00
200	ANALYST	2000.00


INSERT INTO EMP VALUES (1000, "SMITH", 100, 10), (2000, "TOM", 200, 10),
(300, "JIM", 100, 20), (400, "BOB", 200, 20);

SELECT * FROM EMP;

# EMPNO	ENAME	JOBCODE	DEPTNO
300	JIM	100	20
400	BOB	200	20
1000	SMITH	100	10
2000	TOM	200	10


SELECT * FROM EMP AS E
LEFT JOIN JOB AS J ON E.JOBCODE = J.JOBNO
LEFT JOIN DEPT AS D ON E.DEPTNO = D.DEPTNO
UNION
SELECT * FROM EMP AS E
RIGHT JOIN JOB AS J ON E.JOBCODE = J.JOBNO
RIGHT JOIN DEPT AS D ON E.DEPTNO = D.DEPTNO
ORDER BY JOB, ENAME;

# EMPNO	ENAME	JOBCODE	DEPTNO	JOBNO	JOB	SAL	DEPTNO	DNAME
							30	PERSONNEL
400	BOB	200	20	200	ANALYST	2000.00	20	SALES
2000	TOM	200	10	200	ANALYST	2000.00	10	ACCOUNTING
300	JIM	100	20	100	DBA	2500.00	20	SALES
1000	SMITH	100	10	100	DBA	2500.00	10	ACCOUNTING


SELECT * FROM EMP AS E
LEFT JOIN JOB AS J ON E.JOBCODE = J.JOBNO
LEFT JOIN DEPT AS D ON E.DEPTNO = D.DEPTNO
UNION
SELECT * FROM EMP AS E
RIGHT JOIN JOB AS J ON E.JOBCODE = J.JOBNO
RIGHT JOIN DEPT AS D ON E.DEPTNO = D.DEPTNO
WHERE DNAME IN ("ACCOUNTING", "SALES")
ORDER BY JOB, ENAME;

# EMPNO	ENAME	JOBCODE	DEPTNO	JOBNO	JOB	SAL	DEPTNO	DNAME
400	BOB	200	20	200	ANALYST	2000.00	20	SALES
2000	TOM	200	10	200	ANALYST	2000.00	10	ACCOUNTING
300	JIM	100	20	100	DBA	2500.00	20	SALES
1000	SMITH	100	10	100	DBA	2500.00	10	ACCOUNTING


SELECT D.DNAME "Τμήμα", COUNT(E.ENAME) "Πλήθος Εργαζομένων"
FROM DEPT AS D
INNER JOIN EMP AS E
ON D.DEPTNO = E.DEPTNO
GROUP BY D.DEPTNO HAVING COUNT(E.ENAME) >= 2;

# Τμήμα		Πλήθος Εργαζομένων
SALES		2
ACCOUNTING	2


SELECT E.ENAME, D.DNAME, J.SAL
FROM EMP AS E
INNER JOIN DEPT AS D ON E.DEPTNO = D.DEPTNO
INNER JOIN JOB AS J ON J.JOBNO = E.JOBCODE
WHERE E.ENAME LIKE "_Ο" OR J.JOB = "ANALYST";

# Όνομα Υπαλλήλου	Τμήμα		Μισθός
TOM			ACCOUNTING	2000.00
BOB			SALES		2000.00


SELECT ENAME "Ονόματα Υπαλλήλων" 
FROM EMP AS E
INNER JOIN JOB AS J
ON E.JOBCODE = J.JOBNO
WHERE ENAME NOT IN ("SMITH") 
AND SAL = ( SELECT SAL FROM JOB AS A
		INNER JOIN EMP AS B
                ON A.JOBNO = B.JOBCODE
                WHERE ENAME = "SMITH"  );
                
# Ονόματα Υπαλλήλων
JIM

			